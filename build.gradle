// TODO: split test harness (util/*, IntegrationTest, configuration/*) into its own subproject

plugins {
    id 'java'
    id 'maven'
    id 'maven-publish'
}

repositories {
   jcenter()
}

sourceCompatibility = '1.8'
targetCompatibility = '1.8'
group = 'com.exclamationlabs.connid'

def build_version = System.getenv('BUILD_NUMBER') == null ? 'SNAPSHOT' : System.getenv('BUILD_NUMBER')
project.version="${software_version}-${build_version}"

dependencies {

    ////// Begin - Vital dependencies for Base Connector
    compile 'org.apache.commons:commons-lang3:3.8.1'
    compile 'net.tirasa.connid:connector-test-common:1.5.0.0'
    compile 'com.auth0:java-jwt:3.10.3'
    ////// End - Vital dependencies for Base Connector

    // HTTP/RESTful support
    compile 'com.google.code.gson:gson:2.8.6'
    compile 'org.apache.httpcomponents:httpclient:4.5.10'

    // PEM Private key support
    compile 'org.bouncycastle:bcpkix-jdk15on:1.58'

    /// NOTE: test referencing eLabs artifacts
    //compile 'com.exclamationlabs.connector:connector-base-test:0.1'
    //compile 'com.exclamationlabs.connector:connector-base-test:8563'

    //compile(group: 'com.evolveum.icf', name: 'dummy-connector', version: '3.8-SNAPSHOT', classifier: 'sources')

    //compile(group: 'com.evolveum.icf', name: 'dummy-resource', version: '3.8-20180329.150050-1', classifier: 'sources')
    //compile 'com.evolveum.icf:dummy-resource:3.8-20180329.150050-1:sources'
    //compile 'com.google.guava:guava:10.0'

    testImplementation 'junit:junit:4.12'
    testImplementation 'org.mockito:mockito-core:3.1.0'
    testImplementation 'net.tirasa.connid:connector-framework-internal:1.5.0.0'
}

// TODO: remove this later, simulating Jenkins secretfile
/*
test {
    environment "__bcon__development__exclamation_labs__gotomeeting", "/Users/mneugebauer/Documents/test/simsecret.txt"
}
 */

test {
   exclude '**/authenticator/integration/*'
}

task testJar(type: Jar) {
    archiveClassifier = 'test'
    from sourceSets.test.output
    exclude('**/ConnectorBundleTest*', '**/stub/*',
            '**/stub', '**/Stub*')
}

jar.dependsOn('testJar')

artifacts {
    archives testJar
}

task generatePom {
    doLast {
        pom().writeTo("build/libs/${project.name}-${project.version}.pom")

        pom {
            artifactId = 'connector-base-test'
        }.writeTo("build/libs/${project.name}-${project.version}-test.pom")

    }
}
build.dependsOn(generatePom)
